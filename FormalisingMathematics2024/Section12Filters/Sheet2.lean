/-
Copyright (c) 2023 Kevin Buzzard. All rights reserved.
Released under Apache 2.0 license as described in the file LICENSE.
Author : Kevin Buzzard
-/
import Mathlib.Tactic
-- imports all the Lean tactics
import Mathlib.Order.Filter.Basic

/-!

# The order (â‰¤) on filters

We think of filters as generalised subsets, and just as subsets are partially ordered
by `âŠ†`, filters are partially ordered too, by `â‰¤`. Recall that a subset `X : set Î±`
of `Î±` gives rise to a principal filter `ğ“Ÿ X : filter Î±`, and we definitely
want `X âŠ† Y â†” ğ“Ÿ X â‰¤ ğ“Ÿ Y` so let's think about how this should work. If `F` and `G`
are filters, then `F â‰¤ G` should mean "the generalised subset `F` is contained
in the generalised subset `G`", so it should mean "if a normal subset of Î± contains
`G` then it contains `F`", so it should mean `G.sets âŠ† F.sets`, which is in fact
the definition. Note that the smaller the filter `F`, the bigger the collection
`F.sets`, because `F` is contained in more sets!

In the `Filter` namespace there's a lemma


Let's formalise this. Show that ğ“Ÿ S â‰¤ ğ“Ÿ T â†” S âŠ† T.
Note that this is called `principal_mono` in mathlib but
there's no harm in proving it yourself.

Some helpful lemmas (all in the `Filter` namespace):

`mem_principal : T âˆˆ ğ“Ÿ S â†” S âŠ† T`
`mem_principal_self S : S âˆˆ ğ“Ÿ S`
`le_def : F â‰¤ G â†” âˆ€ (S : Set Î±), S âˆˆ G â†’ S âˆˆ F`

-/

namespace Section12sheet2

variable {Î± : Type}

open Filter Set
-- so we don't keep having to type `Filter.le_def` and `Set.Subset.trans` etc

open scoped Filter
-- for ğ“Ÿ notation

example (S T : Set Î±) : ğ“Ÿ S â‰¤ ğ“Ÿ T â†” S âŠ† T := by
  constructor
  Â· intro h1
    rw [le_def] at h1
    rw [â† mem_principal]
    have hT : T âˆˆ ğ’« T := mem_principal_self T
    specialize h1 T hT
    assumption
  Â· intro h2
    rw [le_def]
    intro x hx
    rw [mem_principal] at hx âŠ¢
    exact Subset.trans h2 hx

-- Here's another useful lemma about principal filters.
-- It's called `le_principal_iff` in mathlib but why
-- not try proving it yourself?
example (F : Filter Î±) (S : Set Î±) : F â‰¤ ğ“Ÿ S â†” S âˆˆ F := by
  constructor
  Â· intro hFPS
    rw [le_def] at hFPS
    apply hFPS
    exact mem_principal_self S
  Â· intro hSF
    rw [le_def]
    intro x hx
    rw [mem_principal] at hx
    exact mem_of_superset hSF hx
/-

## Filters are a complete lattice

First I claim that if Fáµ¢ are a bunch of filters, indexed by `i : I`, then
the intersection of `Fáµ¢.sets` is also a filter. Let's check this.

-/
def lub {I : Type} (F : I â†’ Filter Î±) : Filter Î± where
  sets := {X | âˆ€ i, X âˆˆ F i}
  univ_sets := by {
    intro i
    exact univ_mem
  }
  sets_of_superset := by {
    intro S T hS hST
    intro i
    exact mem_of_superset (hS i) hST
  }
  inter_sets := by {
    intro S T hS hT i
    exact inter_mem (hS i) (hT i)
  }

/-

Now let's check that this is a least upper bound for the Fáµ¢! We check the
two axioms.

-/
-- it's an upper bound
example (I : Type) (F : I â†’ Filter Î±) (i : I) : F i â‰¤ lub F := sorry

-- it's â‰¤ all other upper bounds
example (I : Type) (F : I â†’ Filter Î±) (G : Filter Î±) (hG : âˆ€ i, F i â‰¤ G) :
    lub F â‰¤ G := sorry

/-

Just like it's possible to talk about the topological space generated
by a collection of subsets of `Î±` -- this is the smallest topology
for which the given subsets are all open -- it's also possible to talk
about the filter generated by a collection of subsets of `Î±`. One
can define it as the intersection of all the filters that contain your
given collection of subsets (we just proved above that this is a filter).
This gives us a definition of greatest lower bound for filters too.

-/
-- greatest lower bound of filters Fáµ¢ is the least upper bound of the filters G whose `sets`
-- contain all of the `Fáµ¢.sets`
def glb {I : Type} (F : I â†’ Filter Î±) : Filter Î± :=
  lub fun G : {G : Filter Î± | âˆ€ i, (F i).sets âŠ† G.sets} â†¦ G.1

-- it's a lower bound
example (I : Type) (F : I â†’ Filter Î±) (i : I) : glb F â‰¤ F i := by
  rintro S hS âŸ¨_, hGâŸ©
  exact hG i hS

-- it's â‰¥ all other lower bounds
example (I : Type) (F : I â†’ Filter Î±) (G : Filter Î±) (hG : âˆ€ i, G â‰¤ F i) :
    G â‰¤ glb F := by
    intro S hS
    unfold glb at hS
    dsimp at hS
    unfold lub at hS
    specialize hS âŸ¨G, _âŸ©
    Â· exact hG
    Â· exact hS

end Section12sheet2
